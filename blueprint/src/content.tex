The proof of the infinitude of primes via the fact that $\log x\le \pi(x)+1$ is the fourth proof of this theorem in Aigner \& Ziegler's "Proofs from THE BOOK", and attributed to Euler. I'm a hobby mathematician learning to formalize proofs in the Lean4 language. I chose this proof as a beginner project, not knowing exactly what I went into. However,  the best way to know in many occasions is to make a map, hence this blueprint. The aim of this formalization is to stay close to the text.


\begin{lemma}
\label{lem:lemma0}
\lean{log_le_harmonic}
\leanok
For $n\in\mathbb{N}$, $x\in\mathbb{R}$, $n\le x < n+1$,
$$\log x \le \sum_{i=1}^n\frac1i.$$
\end{lemma}
\begin{proof}
\leanok
    We use Mathlib's lemma \texttt{log_add_one_le_harmonic} which proves the inequality for $n+1$.
\end{proof}

\begin{lemma}
\label{lem:lemma1}
\lean{H_P4_1}
\leanok
Given the infinite set $S_x$ of all numbers $m$ that have only prime factors $p\le x$,
    $$\sum_{k=1}^n\frac1k \le \sum_{m\in S_x}\frac{1}{m}. $$
\end{lemma}

\begin{lemma}
\label{lem:lemma2}
\lean{H_P4_2}
\leanok
Given the infinite set $S_x$ of all numbers $m$ that have only prime factors $p\le x$,
    $$\sum_{m\in S_x}\frac{1}{m} = \underset{p\le x}{\prod_{p\in\mathbb{P}}}\Big(\sum_{k\in\mathbb{N}}\frac{1}{p^k}\Big).$$
\end{lemma}

\begin{lemma}
\label{lem:lemma3}
\lean{H_P4_3}
\leanok
    $$\underset{p\le x}{\prod_{p\in\mathbb{P}}}\Big(\sum_{k\in\mathbb{N}}\frac{1}{p^k}\Big) = \underset{p\le x}{\prod_{p\in\mathbb{P}}}\frac{p}{p-1}$$
\end{lemma}

\begin{lemma}
\label{lem:lemma4-1}
\lean{H_P4_4a}
\leanok
For $k,p \in\mathbb{R}$, $k\ge0$, $p \ge k+1$,
$$\frac{p}{p-1} \le \frac{k+1}{k}.$$
\end{lemma}
\begin{proof}
\leanok
The current proof is by algebraic manipulation of fractions.
\end{proof}

\begin{definition-pre}
\label{def:piReal}
\lean{primeCountingReal}
Given the prime counting function $\pi(n)$, $n\in\mathbb{N}$, we define $\pi(x)$, $x\in\mathbb{R}$ as $\pi(x) = \pi(|\lfloor x\rfloor|)$ for $x\ge2$, and $0$ otherwise.
\end{definition-pre}

\begin{lemma}
\label{lem:lemma4}
\lean{H_P4_4}
\uses{lem:lemma4-1}
$$\underset{p\le x}{\prod_{p\in\mathbb{P}}}\frac{p}{p-1} \le \prod_{k=1}^{\pi(x)}\frac{k+1}{k}.$$
\end{lemma}

\begin{lemma}
\label{lem:lemma5-2-1}
\lean{monotone_primeCountingReal}
\leanok
$\pi(x)$ is monotone.
\end{lemma}
\begin{proof}
\leanok
By cases and the monotonicity of $\pi(n)$ and that of the floor function.
\end{proof}

\begin{lemma}
\label{lem:lemma5-2}
\lean{primeCountingReal_ge_two}
\uses{lem:lemma5-2-1}
\leanok
For $x\ge3$, $\pi(x)\ge2$.
\end{lemma}

\begin{lemma}
\label{lem:lemma5-1}
\lean{prod_Icc_succ_div}
\leanok
For $n\ge2$,
    $$\prod_{k=1}^{n}\frac{k+1}{k} = n+1.$$
\end{lemma}
\begin{proof}
\leanok
We transform into a product over the open interval and use the existing Mathlib4's lemmata in an induction proof.
\end{proof}

\begin{lemma}
\label{lem:lemma5}
\lean{H_P4_5}
\uses{lem:lemma5-1, lem:lemma5-2}
\leanok
For $x\ge3$,
    $$\prod_{k=1}^{\pi(x)}\frac{k+1}{k} = \pi(x)+1.$$
\end{lemma}

\begin{theorem}
\label{thm:log_le_primeCountingReal_add_one}
\lean{log_le_primeCountingReal_add_one}
\uses{lem:lemma0, lem:lemma1, lem:lemma2, lem:lemma3, lem:lemma4, lem:lemma5}
\leanok
For $x\in\mathbb{R}$, $\log x \le \pi(x) +1$.
\end{theorem}

\begin{theorem}
\label{thm:primeCountingReal_unbounded}
\lean{primeCountingReal_unbounded}
\uses{thm:log_le_primeCountingReal_add_one}
\leanok
The prime counting function in the real domain, $\pi:\ \mathbb{R} \mapsto \mathbb{N} \ := \#\big\{p\mid p \in\mathbb{P}, p\le x \big\}$ is unbounded above.
\end{theorem}

\begin{theorem}
\label{thm:infinite_primes}
\lean{infinite_setOf_prime}
\leanok
\uses{thm:primeCountingReal_unbounded}
The set $\mathbb{P} = \big\{p \in \mathbb{N} \ \mid \ p \ \mathrm{prime} \big\}$ is infinite. 
\end{theorem}

